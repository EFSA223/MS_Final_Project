<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />

  <title>MS-Final Assignment @2020</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta charset="utf-8">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- symbols in sidebar -->

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />
  <link rel="stylesheet" href="libs/css/leaflet-sidebar.css" />
  <!-- Marker Clusters -->
  <link rel="stylesheet" href="libs/MarkerCluster.Default.css">
  <!-- <link rel="stylesheet" href="../libs/MarkerCluster.css"> -->
  <!-- Sidebar V-2 -->
  <link rel="stylesheet" href="libs/css/leaflet-sidebar.css" />

  <style>
    body {
      /* font-family: sans-serif; */
      margin: 0;
      padding: 0;
    }

    html,
    body,
    #map {
      position: absolute;
      width: 100%;
      top: 0;
      bottom: 0;
    }

    .filter {
      position: absolute;
      right: 48px;
      width: 260px;
      font-size: 1.3em;
    }
  </style>
</head>

<body>
  <!-- <div id="map"></div> -->

  <div id="sidebar" class="sidebar collapsed">
    <!-- Nav tabs -->
    <div class="sidebar-tabs">
      <ul role="tablist">
        <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
        <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
        <li class="disabled"><a href="#messages" role="tab"><i class="fa fa-envelope"></i></a></li>
        <li><a href="https://github.com/Turbo87/sidebar-v2" role="tab" target="_blank"><i class="fa fa-github"></i></a>
        </li>
      </ul>

      <ul role="tablist">
        <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
      </ul>
    </div>

    <!-- Tab panes -->
    <div class="sidebar-content">
      <div class="sidebar-pane" id="home">
        <h1 class="sidebar-header">
          Road Crashes Utrecht, The Netherland
          <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
        </h1>

        <p>A responsive sidebar for mapping libraries like <a href="http://leafletjs.com/">Leaflet</a> or <a
            href="http://openlayers.org/">OpenLayers</a>.</p>

        <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
          sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
          sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren,
          no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing
          elitr,
          sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
          sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren,
          no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

        <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
          sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
          sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren,
          no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing
          elitr,
          sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
          sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren,
          no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

      </div>

      <div class="sidebar-pane" id="profile">
        <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
      </div>

      <div class="sidebar-pane" id="messages">
        <h1 class="sidebar-header">Messages<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
      </div>

      <div class="sidebar-pane" id="settings">
        <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
      </div>
    </div>
  </div>

  <div id="map" class="sidebar-map"></div>

  <!--JQuery-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <!--D3-->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <!--Leaflet-->
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
    integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
    crossorigin=""></script>
  <!--Sidebar-->
  <script src="libs/js/leaflet-sidebar.js"></script>

  <script>
    // we may not need to use icons here ... if just plain circles
    var iconA = L.icon({
      iconUrl: 'icons/circle_red.jpg',
      iconSize: [10, 10], // size of the icon 
    });
    var iconB = L.icon({
      iconUrl: 'icons/circle_blue.jpg',
      iconSize: [10, 10], // size of the icon 
    });
    var iconC = L.icon({
      iconUrl: 'icons/circle_green.jpg',
      iconSize: [10, 10], // size of the icon 
    });

    var map = L.map("map", {
      zoomSnap: 0.1,
      center: [52.119, 5.197], // Utrecht
      zoom: 11
    });

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map);

    // make multiple requests for all your data first
    const utrecht15Request = d3.json('data/clean/gemeenten_utrecht_15.geojson');

    // this should probably be a CSV file to reduce file size, and then converted to GeoJSON for mapping
    const utrecht18Request = d3.json('data/clean/data-1589838631776_UTRECHT_2015-2018_5.geojson');

    // then use a solution like Promise to wait until the data is loaded
    Promise.all([utrecht15Request, utrecht18Request]).then(function (data) {

      // what gets passed from the method?
      console.log(data)

      // separate your datasets and reference with variables
      const utrech15Json = data[0];
      const utrecht18Json = data[1];

      // call more functions and pass the data
      drawMap(utrech15Json, utrecht18Json);

      // Add sidebar to the map
      var sidebar = L.control.sidebar('sidebar').addTo(map);

    });

    function drawMap(utrech15Json, utrecht18Json) {

      // create a Leaflet GeoJSON object using the data and add it to the map
      var geojsonMarkerOptions = {
        radius: 2,
        fillColor: "#142850",
        color: "#cccccc",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
      };

      L.geoJson(utrech15Json, {
        style: function (feature) {
          return {
            color: '#1f78b4',
            weight: 0.9,
            fillOpacity: 0.2,
            fillColor: '#dddddd'
          };
        },
        onEachFeature: function (feature, layer) {
          var countyName = feature.properties.NAME_2;
          layer.bindTooltip(countyName);
          layer.on({
            click: zoomToFeature
          });
        }
      }).addTo(map);

      //===== Filter per Year
      const schade16 = L.geoJson(utrecht18Json, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, geojsonMarkerOptions);
        },
        filter: function (feature) {
          if (feature.properties.jaar_vkl == 2016) {
            return feature;
          }
          //console.log(feature);
        },
        style: function (feature) {
          return {
            radius: 2,
            color: '#1f78b4',
            fillColor: '#009933',
            //radius: getRadius(feature.properties.fuel_source.Hydro)
          }
        }
      }).addTo(map);

      const schade17 = L.geoJson(utrecht18Json, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, geojsonMarkerOptions);
        },
        filter: function (feature) {
          if (feature.properties.JAAR_VKL == 2017) {
            return feature;
          }
          //console.log(feature);
        },
        style: function (feature) {
          return {
            radius: 2,
            color: '#1f78b4',
            fillColor: '#3333ff',
            //radius: getRadius(feature.properties.fuel_source.Hydro)
          }
        }
      }) //.addTo(map);

      const schade18 = L.geoJson(utrecht18Json, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, geojsonMarkerOptions);
        },
        filter: function (feature) {
          if (feature.properties.JAAR_VKL == 2018) {
            return feature;
          }
          //console.log(feature);
        },
        style: function (feature) {
          return {
            radius: 2,
            color: '#1f78b4',
            fillColor: '#ff0000',
            //radius: getRadius(feature.properties.fuel_source.Hydro)
          }
        }
      }) //.addTo(map);


      //===== Filter per type accident

      const schadeUms = L.geoJson(utrecht18Json, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, geojsonMarkerOptions);
        },
        filter: function (feature) {
          if (feature.properties.AP3_CODE == "UMS") {
            return feature;
          }
          //console.log(feature);
        },
        style: function (feature) {
          return {
            radius: 2,
            color: '#1f78b4',
            fillColor: '#009933',
            //radius: getRadius(feature.properties.fuel_source.Hydro)
          }
        }
      }) //.addTo(map);

      var letsels = L.geoJson(utrecht18Json, {
        pointToLayer: function (feature2, latlng) {
          return L.circleMarker(latlng, geojsonMarkerOptions);
        },
        filter: function (feature2) {
          if (feature2.properties.AP3_CODE == "LET") {
            return feature2;
          }
          //console.log(feature2);
        },
        style: function (feature2) {
          return {
            radius: 3,
            color: '#1f78b4',
            fillColor: '#3333ff',
            //radius: getRadius(feature.properties.fuel_source.Hydro)
          }
        }
      }) //.addTo(map);

      var fatalies = L.geoJson(utrecht18Json, {
        pointToLayer: function (feature3, latlng) {
          return L.circleMarker(latlng, geojsonMarkerOptions);
        },
        filter: function (feature3) {
          if (feature3.properties.ap3_code == "DOD") {
            return feature3;
          }
          //console.log(feature3);
        },
        style: function (feature3) {
          return {
            radius: 5,
            color: '#1f78b4',
            fillColor: '#ff0000',
            //radius: getRadius(feature.properties.fuel_source.Hydro)
          }
        }
      }) //.addTo(map);

    }








    // loop through all the crashes
    // fatalies.eachLayer(function (layer) {
    //   // access the name for each
    //   var popup=
    //     "<p>"
    //            + //"Informatie:"+"<br>"+
    //           // "<ul>"+
    //                 "<li>Year: "+layer.feature.properties.jaar_vkl+"</li>"+
    //                 "<li>Provincie: "+layer.feature.properties.pve_code+"</li>"+
    //                 "<li>Categorie: "+layer.feature.properties.ap3_code+"</li>"+
    //           // "</ul>"+
    //     "</p>";
    //   // bind that name to a tooltip
    //   layer//.bindTooltip(popup);
    // });


    //===

    // function dataFilter(data) {      
    //           const accident = data;
    //           const dataYear = []     
    //             var markers = L.markerClusterGroup();                                 // create new markerClusterGroup    
    //             accident.features.forEach(function(feature) {                          // loop through all our signals features    
    //               var coords = feature.geometry.coordinates
    //               var cat =  feature.properties.jaar_vkl 
    //               switch (cat ) {
    //                 case 2018:
    //                   marker = L.marker([coords[1], coords[0]], {
    //                     icon : iconA                           
    //                   });
    //                 case 2017:
    //                   marker = L.marker([coords[1], coords[0]], {
    //                     icon : iconB
    //                   })
    //                 case 2016:
    //                   marker = L.marker([coords[1], coords[0]], {
    //                     icon : iconC
    //                   });
    //                 case 2015:
    //                   marker = L.marker([coords[1], coords[0]], {
    //                     icon : iconA
    //                 }); 
    //               }
    //               console.log(dataYear);
    //               marker.bindTooltip("YEAR: " + feature.properties.jaar_vkl);         // bind a tooltip to the marker
    //               markers.addLayer(marker);  
    //               //console.log(cat);                                        // add the marker to the markerClusterGroup
    //           });
    //           map.addLayer(markers);                                         // add the markerClusterGroup to the map
    //         };

    //===

    // function dataCluster(data) {
    //   const accident = data;
    //   var markers = L.markerClusterGroup(); // create new markerClusterGroup    
    //   accident.features.forEach(function (feature) { // loop through all our signals features    
    //     var coords = feature.geometry.coordinates
    //     var cat = feature.properties.ap3_code
    //     if (cat == "DOD") {
    //       marker = L.marker([coords[1], coords[0]], {
    //         icon: iconA
    //       });
    //     } else if (cat == "LET") {
    //       marker = L.marker([coords[1], coords[0]], {
    //         icon: iconB
    //       });
    //     } else {
    //       marker = L.marker([coords[1], coords[0]], {
    //         icon: iconC
    //       });
    //     };
    //     marker.bindTooltip("YEAR: " + feature.properties.jaar_vkl); // bind a tooltip to the marker
    //     markers.addLayer(marker); // add the marker to the markerClusterGroup
    //     //console.log(cat);                                        
    //   });
    //   map.addLayer(markers); // add the markerClusterGroup to the map
    // }

    function zoomToFeature(e) {
      map.fitBounds(e.target.getBounds());
    }
  </script>
</body>

</html>